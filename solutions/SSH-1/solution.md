# Настройка ssh
По умолчанию для подключения по ssh используется порт 22. Порт по умолчанию можно изменить,
если раскомментровать строку `Port 22` в файле `/etc/openssh/sshd_config` и указать новый порт.

Службой, отвечающей за обработку запросов на подключения по ssh в Linux, является sshd.
За настройку этого демона отвечает файл `/etc/openssh/sshd_config`.

Подключение по ssh осуществляется командой `ssh`, где указывается адрес сервера, логин и порт.
```
ssh 95.31.204.147 -l student -p 230
```
![1.png](/solutions/SSH-1/screenshots/1.png)

Чтобы была возможность подключиться к серверу, используя пользователя root, а также
изменить количество ошибок ввода пароля перед сбросом соединения, необходимо отредактировать файл конфигурации sshd.
```
sudo vim /etc/openssh/sshd_config
```
Здесь нужно раскомменитровать строку, начинающуюся на `PermitRootLogin`, и заменить на `PermitRootLogin yes`. 
А также раскомменитровать строку, начинающуюся на `MaxAuthTries`, и заменить на `MaxAuthTries 3`.
Затем перезапустить sshd, чтобы применить изменения.
```
sudo systemctl restart sshd
```
![2.png](/solutions/SSH-1/screenshots/2.png)

Создадим пользователя `sudo useradd ssh-user`, зададим ему пароль `sudo passwd ssh-user` и подключимся по ssh.
```
ssh 95.31.204.147 -l ssh-user -p 230
```
![3.png](/solutions/SSH-1/screenshots/3.png)

Чтобы ограничить возможность подключаться к серверу, используя определенного пользователя, необходимо отредактировать файл конфигурации sshd.
```
sudo vim /etc/openssh/sshd_config
```
Здесь нужно добавить строку `DenyUsers ssh-user`. Затем перезапустить sshd, чтобы применить изменения.
```
sudo systemctl restart sshd
```
![4.png](/solutions/SSH-1/screenshots/4.png)

Файл known_hosts расположен в домашней папке пользователя и хранит список известных серверов и их открытые ssh-ключи.
При первом подключении к новому серверу ssh-клиент сохраняет его ключ в этот файл.
При последующих подключениях ssh-клиент проверяет соответствие ключа сервера и ключа, сохраненного в файле.
```
cat .ssh/known_hosts
```
![5.png](/solutions/SSH-1/screenshots/5.png)
